{% extends "base.html" %}

{% block title %}View B2B Lead - CRM System{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
<li class="breadcrumb-item"><a href="{{ url_for('leads_b2b.index') }}">B2B Leads</a></li>
<li class="breadcrumb-item active">View Lead</li>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="bi bi-eye text-primary"></i>
                View B2B Lead
            </h2>
            <div>
                <a href="{{ url_for('leads_b2b.edit', sr_no=lead.sr_no) }}" class="btn btn-secondary me-2">
                    <i class="bi bi-pencil"></i> Edit
                </a>
                <a href="{{ url_for('leads_b2b.index') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Leads
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Lead Details</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Sr No:</dt>
                            <dd class="col-sm-7">{{ lead.sr_no or '-' }}</dd>

                            <dt class="col-sm-5">Organization:</dt>
                            <dd class="col-sm-7">{{ lead.organization_name }}</dd>

                            <dt class="col-sm-5">Email:</dt>
                            <dd class="col-sm-7">{{ lead.organization_email or '-' }}</dd>

                            <dt class="col-sm-5">Location:</dt>
                            <dd class="col-sm-7">{{ lead.location or '-' }}</dd>

                            <dt class="col-sm-5">Type of Leads:</dt>
                            <dd class="col-sm-7">{{ lead.type_of_leads or '-' }}</dd>

                            <dt class="col-sm-5">POC & Role:</dt>
                            <dd class="col-sm-7">{{ lead.org_poc_name_and_role or '-' }}</dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-5">Employee Size:</dt>
                            <dd class="col-sm-7">{{ lead.employee_size or '-' }}</dd>

                            <dt class="col-sm-5">Wellness Program:</dt>
                            <dd class="col-sm-7">{{ lead.employee_wellness_program or '-' }}</dd>

                            <dt class="col-sm-5">Budget:</dt>
                            <dd class="col-sm-7">{{ lead.budget_of_wellness_program or '-' }}</dd>

                            <dt class="col-sm-5">Last Activity:</dt>
                            <dd class="col-sm-7">{{ lead.last_wellness_activity_done or '-' }}</dd>

                            <dt class="col-sm-5">Date:</dt>
                            <dd class="col-sm-7">{{ lead.date.strftime('%d/%m/%Y') if lead.date else '-' }}</dd>

                            <dt class="col-sm-5">Status:</dt>
                            <dd class="col-sm-7">
                                <span class="badge bg-primary">{{ lead.status or 'New' }}</span>
                            </dd>
                        </dl>
                    </div>
                </div>


                <!-- Meeting Information -->
                {% if lead.meeting1 or lead.meeting2 %}
                <div class="mt-3">
                    <h6>Meeting Information:</h6>
                    {% if lead.meeting1 %}
                    <p><strong>Meeting 1:</strong> {{ lead.meeting1.strftime('%d/%m/%Y') if lead.meeting1 else '-' }}</p>
                    {% if lead.meeting1_notes %}<p><strong>Notes:</strong> {{ lead.meeting1_notes }}</p>{% endif %}
                    {% if lead.meeting1_task_done %}<p><strong>Task Done:</strong> {{ lead.meeting1_task_done }}</p>{% endif %}
                    {% endif %}
                    {% if lead.meeting2 %}
                    <p><strong>Meeting 2:</strong> {{ lead.meeting2.strftime('%d/%m/%Y') if lead.meeting2 else '-' }}</p>
                    {% endif %}
                    {% if lead.notes %}<p><strong>Notes:</strong> {{ lead.notes }}</p>{% endif %}
                    {% if lead.task_done %}<p><strong>Task Done:</strong> {{ lead.task_done }}</p>{% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('leads_b2b.follow_up', sr_no=lead.sr_no) }}" class="btn btn-info">
                        <i class="bi bi-clock"></i> Add Follow-up
                    </a>
                    <a href="{{ url_for('leads_b2b.meeting', sr_no=lead.sr_no) }}" class="btn btn-success">
                        <i class="bi bi-calendar-event"></i> Add Meeting
                    </a>
                    <a href="{{ url_for('leads_b2b.edit', sr_no=lead.sr_no) }}" class="btn btn-secondary">
                        <i class="bi bi-pencil"></i> Edit Lead
                    </a>
                </div>
            </div>
        </div>

        {% if lead.follow_ups.count() > 0 %}
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="card-title mb-0">Follow-ups ({{ lead.follow_ups.count() }})</h5>
            </div>
            <div class="card-body">
                {% for followup in lead.follow_ups %}
                <div class="border-bottom pb-2 mb-2">
                    <small class="text-muted">{{ followup.follow_up_on.strftime('%d/%m/%Y') }}</small>
                    <p class="mb-1">{{ followup.notes or 'No notes' }}</p>
                    <small class="text-info">{{ followup.outcome.value.replace('_', ' ') }}</small>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if lead.meetings|length > 0 %}
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="card-title mb-0">Meetings ({{ lead.meetings|length }})</h5>
            </div>
            <div class="card-body">
                {% for meeting in lead.meetings %}
                <div class="border-bottom pb-2 mb-2">
                    <small class="text-muted">
                        {% if meeting.meeting1_date %}Meeting 1: {{ meeting.meeting1_date.strftime('%d/%m/%Y') }}{% endif %}
                        {% if meeting.meeting2_date %} | Meeting 2: {{ meeting.meeting2_date.strftime('%d/%m/%Y') }}{% endif %}
                    </small>
                    {% if meeting.meeting1_notes %}
                    <p class="mb-1"><strong>Meeting 1 Notes:</strong> {{ meeting.meeting1_notes }}</p>
                    {% endif %}
                    {% if meeting.meeting1_task_done %}
                    <p class="mb-1"><strong>Meeting 1 Tasks:</strong> {{ meeting.meeting1_task_done }}</p>
                    {% endif %}
                    {% if meeting.notes %}
                    <p class="mb-1"><strong>Notes:</strong> {{ meeting.notes }}</p>
                    {% endif %}
                    {% if meeting.task_done %}
                    <p class="mb-1"><strong>Tasks Done:</strong> {{ meeting.task_done }}</p>
                    {% endif %}
                    {% if meeting.status %}
                    <small class="text-success">Status: {{ meeting.status }}</small>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}